<!DOCTYPE html>
<html>
<head>
    <title>XTerm.js Test</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/xterm@5.3.0/css/xterm.css" />
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #1e1e1e;
            color: white;
        }
        #terminal {
            margin: 20px 0;
            border: 1px solid #444;
        }
        button {
            margin: 5px;
            padding: 8px 16px;
            background: #007acc;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background: #005a9e;
        }
        .test-section {
            margin: 20px 0;
            padding: 10px;
            border: 1px solid #444;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <h1>XTerm.js Test Page</h1>
    
    <div class="test-section">
        <h3>Basic Terminal Test</h3>
        <div id="terminal"></div>
        <button onclick="testBasicOutput()">Test Basic Output</button>
        <button onclick="testColors()">Test Colors</button>
        <button onclick="testBoxDrawing()">Test Box Drawing</button>
        <button onclick="testCursor()">Test Cursor Movement</button>
        <button onclick="clearTerminal()">Clear</button>
    </div>

    <div class="test-section">
        <h3>WebSocket Test</h3>
        <button onclick="startWebSocketTest()">Connect WebSocket</button>
        <button onclick="sendTestMessage()">Send Test Message</button>
        <button onclick="disconnectWebSocket()">Disconnect</button>
        <div id="ws-status">Not connected</div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/xterm@5.3.0/lib/xterm.js"></script>
    <script>
        let terminal;
        let websocket;

        // Initialize terminal
        document.addEventListener('DOMContentLoaded', function() {
            terminal = new Terminal({
                cursorBlink: true,
                theme: {
                    background: '#1e1e1e',
                    foreground: '#ffffff',
                    cursor: '#00ff00',
                    black: '#000000',
                    red: '#cd3131',
                    green: '#0dbc79',
                    yellow: '#e5e510',
                    blue: '#2472c8',
                    magenta: '#bc3fbc',
                    cyan: '#11a8cd',
                    white: '#e5e5e5',
                    brightBlack: '#666666',
                    brightRed: '#f14c4c',
                    brightGreen: '#23d18b',
                    brightYellow: '#f5f543',
                    brightBlue: '#3b8eea',
                    brightMagenta: '#d670d6',
                    brightCyan: '#29b8db',
                    brightWhite: '#e5e5e5'
                },
                fontSize: 14,
                fontFamily: 'Consolas, "Liberation Mono", Menlo, Courier, monospace'
            });

            terminal.open(document.getElementById('terminal'));
            terminal.write('XTerm.js initialized successfully!\r\n');
            
            // Enable input
            terminal.onData(data => {
                terminal.write(data);
            });
        });

        function testBasicOutput() {
            terminal.write('\r\n=== Basic Output Test ===\r\n');
            terminal.write('Hello World!\r\n');
            terminal.write('This is a test line\r\n');
            terminal.write('Special chars: !@#$%^&*()\r\n');
        }

        function testColors() {
            terminal.write('\r\n=== Color Test ===\r\n');
            terminal.write('\x1b[31mRed text\x1b[0m\r\n');
            terminal.write('\x1b[32mGreen text\x1b[0m\r\n');
            terminal.write('\x1b[33mYellow text\x1b[0m\r\n');
            terminal.write('\x1b[34mBlue text\x1b[0m\r\n');
            terminal.write('\x1b[35mMagenta text\x1b[0m\r\n');
            terminal.write('\x1b[36mCyan text\x1b[0m\r\n');
            terminal.write('\x1b[1mBold text\x1b[0m\r\n');
            terminal.write('\x1b[4mUnderlined text\x1b[0m\r\n');
        }

        function testBoxDrawing() {
            terminal.write('\r\n=== Box Drawing Test ===\r\n');
            terminal.write('┌─────────────┐\r\n');
            terminal.write('│ Box Drawing │\r\n');
            terminal.write('├─────────────┤\r\n');
            terminal.write('│ Characters  │\r\n');
            terminal.write('└─────────────┘\r\n');
            terminal.write('╔═════════════╗\r\n');
            terminal.write('║ Double Box  ║\r\n');
            terminal.write('╚═════════════╝\r\n');
        }

        function testCursor() {
            terminal.write('\r\n=== Cursor Movement Test ===\r\n');
            terminal.write('Moving cursor: ');
            setTimeout(() => {
                terminal.write('\x1b[10D'); // Move cursor left 10 positions
                terminal.write('\x1b[32mGREEN\x1b[0m');
            }, 1000);
        }

        function clearTerminal() {
            terminal.clear();
            terminal.write('Terminal cleared!\r\n');
        }

        function startWebSocketTest() {
            const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
            // Try to connect to a test session (this will likely fail but we can see the error)
            const wsUrl = `${protocol}//${window.location.host}/ws/test-session`;
            
            document.getElementById('ws-status').textContent = 'Connecting...';
            
            websocket = new WebSocket(wsUrl);
            
            websocket.onopen = () => {
                document.getElementById('ws-status').textContent = 'Connected';
                terminal.write('\r\n[WebSocket connected]\r\n');
            };
            
            websocket.onmessage = (event) => {
                terminal.write(event.data);
            };
            
            websocket.onclose = () => {
                document.getElementById('ws-status').textContent = 'Disconnected';
                terminal.write('\r\n[WebSocket disconnected]\r\n');
            };
            
            websocket.onerror = (error) => {
                document.getElementById('ws-status').textContent = 'Error: ' + error;
                terminal.write('\r\n[WebSocket error]\r\n');
                console.error('WebSocket error:', error);
            };
        }

        function sendTestMessage() {
            if (websocket && websocket.readyState === WebSocket.OPEN) {
                websocket.send('test message\n');
            } else {
                terminal.write('\r\n[WebSocket not connected]\r\n');
            }
        }

        function disconnectWebSocket() {
            if (websocket) {
                websocket.close();
                websocket = null;
            }
        }
    </script>
</body>
</html>